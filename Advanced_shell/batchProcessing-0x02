#!/bin/bash

POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
API_URL="https://pokeapi.co/api/v2/pokemon"
OUT_DIR="pokemon_data"
ERROR_LOG="errors.txt"

mkdir -p "$OUT_DIR"
> "$ERROR_LOG"

for pokemon in "${POKEMONS[@]}"
do
    echo "Fetching data for $pokemon..."
    success=false

    for attempt in 1 2 3
    do
        response=$(curl -s -w "%{http_code}" "$API_URL/$pokemon")
        status_code=$(echo "$response" | tail -c 4)
        body=$(echo "$response" | sed '$d')

        if [ "$status_code" = "200" ]; then
            echo "$body" > "$OUT_DIR/$pokemon.json"
            echo "Saved data to $OUT_DIR/$pokemon.json ✅"
            success=true
            break
        else
            echo "Attempt $attempt failed for $pokemon"
            sleep 1
        fi
    done

    if [ "$success" = false ]; then
        echo "Failed to fetch $pokemon after 3 attempts" >> "$ERROR_LOG"
        echo "Skipping $pokemon ❌"
    fi
done
